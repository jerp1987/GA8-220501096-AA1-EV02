<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <link rel="shortcut icon" href="images/fevicon.png" type="image/x-icon">
  <title>Listado de Citas | SECLICA</title>
  <link rel="stylesheet" type="text/css" href="css/bootstrap.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="css/style.css" />
  <link rel="stylesheet" type="text/css" href="css/responsive.css" />
  <style>
    .table thead th { background: #005e3c; color: #fff; }
    .table td, .table th { vertical-align: middle !important; }
    .form_container { background: #fff; border-radius: 12px; box-shadow: 0 0 20px #0002; padding: 36px 30px 24px 30px; margin-top: 40px; }
    .hero_area { min-height: 120px; margin-bottom: 30px; }
    #alert { margin-top: 16px; }
  </style>
</head>
<body>
<!-- MENÚ SUPERIOR FUNCIONAL -->
<div class="hero_area">
  <div class="hero_bg_box">
    <img src="images/hero-bg.jpg" alt="">
  </div>
  <header class="header_section">
    <div class="header_top">
      <div class="container-fluid header_top_container">
        <div class="contact_nav">
          <a href="#"><i class="fa fa-phone"></i><span>Cel: 3507348436</span></a>
          <a href="#"><i class="fa fa-envelope"></i><span>jhonn1987jerp@gmail.com</span></a>
        </div>
        <div class="social_box">
          <a href="https://www.facebook.com/tucuenta" target="_blank"><i class="fa fa-facebook"></i></a>
          <a href="https://twitter.com/tucuenta" target="_blank"><i class="fa fa-twitter"></i></a>
          <a href="https://www.linkedin.com/in/tucuenta" target="_blank"><i class="fa fa-linkedin"></i></a>
          <a href="https://www.instagram.com/tucuenta" target="_blank"><i class="fa fa-instagram"></i></a>
        </div>
      </div>
    </div>
    <div class="header_bottom">
      <div class="container-fluid">
        <nav class="navbar navbar-expand-lg custom_nav-container">
          <a class="navbar-brand" href="index.html">SECLICA</a>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
                  aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon" style="color:white;">&#9776;</span>
          </button>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav">
              <li class="nav-item"><a class="nav-link" href="index.html">INICIO</a></li>
              <li class="nav-item"><a class="nav-link" href="acceso.html">REGISTRO / ACCESO</a></li>
              <li class="nav-item"><a class="nav-link" href="agendar_citas.html">AGENDAR CITA</a></li>
              <li class="nav-item"><a class="nav-link" href="cancelar_citas.html">CANCELAR CITA</a></li>
            </ul>
          </div>
        </nav>
      </div>
    </div>
  </header>
</div>
<!-- FIN MENÚ -->
 
 <!-- Scripts necesarios para menú hamburguesa -->
<script src="js/jquery-3.4.1.min.js"></script>
<script src="js/bootstrap.js"></script>



<!-- FORMULARIO AGENDAR CITA -->
  <section class="contact_section">
    <div class="container">
      <div class="col-md-8 mx-auto">
        <div class="form_container">
          <div class="heading_container heading_center">
            <h2>Agendar Cita</h2>
          </div>
          <form id="formAgendar" autocomplete="off">
            <div class="form-row">
              <div class="form-group col-md-6">
                <label for="nombre">Nombre</label>
                <input type="text" name="nombre" id="nombre" class="form-control" placeholder="Nombre" required>
              </div>
              <div class="form-group col-md-6">
                <label for="apellido">Apellido</label>
                <input type="text" name="apellido" id="apellido" class="form-control" placeholder="Apellido" required>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group col-md-6">
                <label for="tipo_documento">Tipo de documento</label>
                <select name="tipo_documento" id="tipo_documento" class="form-control" required>
                  <option value="">Seleccione tipo de documento</option>
                  <option value="CC">Cédula de Ciudadanía</option>
                  <option value="CE">Cédula de Extranjería</option>
                  <option value="TI">Tarjeta de Identidad</option>
                </select>
              </div>
              <div class="form-group col-md-6">
                <label for="numero_documento">Número de documento</label>
                <input type="text" name="numero_documento" id="numero_documento" class="form-control" placeholder="Número de documento" required>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group col-md-6">
                <label for="correo">Correo electrónico</label>
                <input type="email" name="correo" id="correo" class="form-control" placeholder="Correo electrónico" required>
              </div>
              <div class="form-group col-md-6">
                <label for="telefono">Teléfono</label>
                <input type="tel" name="telefono" id="telefono" class="form-control" placeholder="Teléfono" required>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group col-md-6">
                <label for="fecha">Fecha</label>
                <input type="date" name="fecha" id="fecha" class="form-control" required>
              </div>
              <div class="form-group col-md-6">
                <label for="placa_vehiculo">Placa del vehículo</label>
                <input type="text" name="placa_vehiculo" id="placa_vehiculo" class="form-control" placeholder="Placa" required>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group col-12">
                <label for="servicio">Servicio</label>
                <select name="servicio" id="servicio" class="form-control" required>
                  <option value="">Seleccione un servicio</option>
                  <option value="Mantenimiento Preventivo">Mantenimiento Preventivo</option>
                  <option value="Sincronización">Sincronización</option>
                  <option value="Reparación Motor">Reparación Motor</option>
                  <option value="Sistema Eléctrico">Sistema Eléctrico</option>
                  <option value="Sistema Alimentación">Sistema Alimentación</option>
                  <option value="Sistemas Frenos">Sistemas Frenos</option>
                  <option value="Sistema Lubricación">Sistema Lubricación</option>
                  <option value="Sistema Dirección">Sistema Dirección</option>
                  <option value="Sistema Alimentación Combustible">Sistema Alimentación Combustible</option>
                  <option value="Sistema Suspensión">Sistema Suspensión</option>
                  <option value="Sistema Electrónico y eléctrico">Sistema Electrónico y eléctrico</option>
                  <option value="Scanner OBD1/OBD2">Scanner OBD1/OBD2</option>
                  <option value="Análisis Gases">Análisis Gases</option>
                  <option value="Mecánica Rápida">Mecánica Rápida</option>
                  <option value="Otros">Otros</option>
                </select>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group col-12">
                <label for="descripcion_adicional">Descripción adicional</label>
                <textarea name="descripcion_adicional" id="descripcion_adicional" class="form-control" placeholder="Descripción adicional"></textarea>
              </div>
            </div>
            <div class="btn_box text-center">
              <button type="submit" class="btn btn-success px-4" id="btnAgendar">Agendar</button>
            </div>
            <div id="mensaje_alerta" class="alert d-none mt-3" role="alert"></div>
          </form>
        </div>
      </div>
    </div>
  </section>

<!-- info section (solo descripción SECLICA, blanco, footer template original) -->
<section class="info_section mt-4 mb-5" style="background:#53b597; border-radius:18px 18px 0 0; padding-top:32px; padding-bottom:0;">
  <div class="container">
    <div class="info_top">
      <div class="row">
        <div class="col-md-12 text-center">
          <span class="navbar-brand" style="font-size:2.2em; color:#F7B500; font-weight:700; letter-spacing:2px; margin-bottom:8px; display:inline-block;">
            SECLICA
          </span>
          <p class="mt-2" style="font-size:1.13em; color:#fff; margin-bottom:0.6em;">
            Somos una empresa prestadora de servicios especializados en mecánica 
            de motocicletas de 2T y 4T en Bogotá.<br>
            Presentamos a nuestros clientes un portafolio que abarca todo lo relacionado 
            con los principales sistemas: inyección, lubricación, alimentación, dirección, 
            frenos, transmisión y refrigeración.
          </p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Footer original del template (con año dinámico) -->
<footer class="footer_section" style="margin-top:-16px;">
  <div class="container">
    <p>
      &copy; <span id="displayYear"></span> All Rights Reserved By
      <a href="https://html.design/">Free Html Templates</a>
    </p>
  </div>
</footer>

<!-- Script para año dinámico -->
<script>
  document.getElementById('displayYear').textContent = new Date().getFullYear();
</script>


  <!-- Scripts iguales -->
  <script src="js/jquery-3.4.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
  <script src="js/bootstrap.js"></script>
  <script src="js/custom.js"></script>

  <script>

// PROTECCIÓN DE ACCESO EN JS
const user = sessionStorage.getItem('auth_user');
if(!user) {
  alert("Debes iniciar sesión para ver tus citas.");
  window.location.href = "acceso.html";
}


    // Script para cargar citas
    const BASE = "/SECLICA/public";
    const tbody = document.querySelector("#tabla-citas tbody");
    const alertBox = document.getElementById("alert");

    function showAlert(text, type="info"){
      alertBox.className = `alert alert-${type}`;
      alertBox.textContent = text;
      alertBox.classList.remove("d-none");
    }
    function hideAlert(){ alertBox.classList.add("d-none"); }

    async function loadCitas() {
      hideAlert();
      tbody.innerHTML = '<tr><td colspan="6" class="text-center">Cargando...</td></tr>';
      try {
        const res = await fetch(`${BASE}/api/citas.php`);
        const j = await res.json();
        const arr = Array.isArray(j.data) ? j.data : (Array.isArray(j) ? j : []);
        if (!arr.length) {
          tbody.innerHTML = '<tr><td colspan="6" class="text-center text-muted">No hay citas registradas.</td></tr>';
          return;
        }
        tbody.innerHTML = arr.map(c => {
          const estado = (c.estado || "").toLowerCase();
          const badge = estado === 'cancelada' ? 'badge badge-danger' :
                        estado === 'pendiente'  ? 'badge badge-warning' :
                        'badge badge-success';
          return `
            <tr>
              <td>${c.id ?? ""}</td>
              <td>${c.nombre ?? c.cliente ?? ""}</td>
              <td>${c.placa ?? ""}</td>
              <td>${c.servicio ?? ""}</td>
              <td>${c.fecha ?? c.fecha_cita ?? ""}</td>
              <td><span class="${badge}">${c.estado ?? ""}</span></td>
            </tr>
          `;
        }).join('');
      } catch (e) {
        tbody.innerHTML = '<tr><td colspan="6" class="text-danger text-center">Error cargando citas.</td></tr>';
        showAlert("Error de red o del servidor.", "danger");
      }
    }

    loadCitas();
  </script>
</body>
</html>