<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Iniciar sesión | Admin / Empleado | SECLICA</title>
  <link rel="stylesheet" href="css/bootstrap.css"/>
  <link rel="stylesheet" href="css/font-awesome.min.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: linear-gradient(135deg, #16763F 45%, #d4f5e9 100%);
      font-family: 'Poppins', Arial, sans-serif;
    }
    .login-box {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 8px 32px #16763F22;
      padding: 36px 28px 32px 28px;
      max-width: 410px;
      width: 96%;
      margin: 32px auto 0 auto;
    }
    .login-box .logo {
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.1em;
      font-weight: bold;
      color: #16763F;
      margin-bottom: 16px;
      letter-spacing: 2px;
    }
    .login-box h3 {
      text-align: center;
      font-weight: 700;
      margin-bottom: 12px;
      color: #222;
      font-size: 1.33em;
    }
    .login-box form label { font-weight: 600; }
    .form-control, select {
      border-radius: 7px;
      font-size: 1.06em;
    }
    .btn-login {
      background: #16763F;
      color: #fff;
      font-weight: 600;
      border: none;
      border-radius: 7px;
      width: 100%;
      padding: 11px;
      margin-top: 12px;
      transition: background .18s;
    }
    .btn-login:hover {
      background: #145c32;
    }
    .msg-error {
      color: #ba181b;
      background: #f5dddd;
      padding: 7px 11px;
      border-radius: 8px;
      margin-bottom: 10px;
      display: none;
      font-size: .99em;
      text-align: center;
    }
    .footer_section {
      width: 100%;
      background: transparent;
      margin-top: 32px;
    }
    .footer_section .container {
      text-align: center;
    }
    .footer_section p {
      font-size: 1em;
      color: #222;
      margin: 0 auto 10px auto;
      letter-spacing: 1px;
    }
    .footer_section a {
      color: #16763F;
      text-decoration: underline;
    }
    @media (max-width:500px) {
      .login-box { padding: 22px 7px; }
      .login-box .logo { font-size: 1.38em; }
      .footer_section p { font-size: .99em; }
    }
  </style>
</head>
<body>
  <div class="login-box">
    <div class="logo"><i class="fa fa-user-shield"></i>&nbsp; SECLICA</div>
    <h3>Iniciar sesión<br>
      <span style="font-size:.77em;font-weight:500;color:#16763F;">Administrador / Empleado</span>
    </h3>
    <div id="msgError" class="msg-error"></div>
    <form id="formLogin" autocomplete="off">
      <div class="form-group">
        <label for="email">Correo electrónico</label>
        <input type="email" class="form-control" id="email" placeholder="Correo" required>
      </div>
      <div class="form-group">
        <label for="password">Contraseña</label>
        <input type="password" class="form-control" id="password" placeholder="Contraseña" required>
      </div>
      <div class="form-group">
        <label for="rol">Rol</label>
        <select class="form-control" id="rol" required>
          <option value="">Seleccione</option>
          <option value="admin">Administrador</option>
          <option value="empleado">Empleado</option>
        </select>
      </div>
      <button type="submit" class="btn btn-login mt-2">
        <i class="fa fa-sign-in"></i> Ingresar
      </button>
    </form>
    <div class="mt-3 text-center" style="font-size:0.98em">
      <a href="index.html" style="color:#16763F;font-weight:600"><i class="fa fa-arrow-left"></i> Volver al inicio</a>
    </div>
  </div>

  <!-- Footer original del template con año dinámico, siempre alineado debajo del formulario -->
  <footer class="footer_section">
    <div class="container">
      <p>
        &copy; <span id="displayYear"></span> All Rights Reserved By
        <a href="https://html.design/">Free Html Templates</a>
      </p>
    </div>
  </footer>

  <script>
    document.getElementById('displayYear').textContent = new Date().getFullYear();

    document.getElementById('formLogin').onsubmit = async function(e){
      e.preventDefault();
      let email = document.getElementById('email').value.trim();
      let password = document.getElementById('password').value;
      let rol = document.getElementById('rol').value;
      let msgError = document.getElementById('msgError');
      msgError.style.display = "none";
      msgError.textContent = "";

      let resp = await fetch('/SECLICA/public/api/login.php', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ email, password, rol })
      });
      let data = await resp.json();
      if(data.success){
        if(data.rol === "admin"){
          window.location.href = "modulo_administrador.html";
        } else if(data.rol === "empleado"){
          window.location.href = "modulo_empleado.html";
        } else {
          msgError.textContent = "Rol inválido.";
          msgError.style.display = "block";
        }
      } else {
        msgError.textContent = data.error || "Error al iniciar sesión";
        msgError.style.display = "block";
      }
    }
  </script>
</body>
</html>